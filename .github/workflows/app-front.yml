name: DeployFrontend

on:
  push:
    branches: [ "Front" ]
    
jobs:
  Deploy:
    name: Deploy Front to EC2 Backend
    runs-on: ubuntu-latest
    
    steps:
    
      - name: Checkout code
        uses: actions/checkout@v3
  
      - name: Set up Node.js
        uses: actions/setup-node@v3
        with:
          node-version: '18'  # Usa la versiÃ³n de Node.js que prefieras
          
      # Despliegue del Backend si las pruebas unitarias pasan
      - name: Deploy Front to EC2 Instance
        env:
          EC2_PRIVATE_KEY: ${{ secrets.SSH_PRIVATE_KEY }}
          SERVER_IP: ${{ secrets.SSH_HOST_BACK_FRONT }}
          EC2_USER: ${{ secrets.USER_NAME }}
        run: |
          echo "$EC2_PRIVATE_KEY" > ec2_key && chmod 600 ec2_key
          ssh -o StrictHostKeyChecking=no -i ec2_key ${EC2_USER}@${SERVER_IP} '
                sudo apt update &&
                sudo apt install -y npm &&
                cd /home/***/Parcial1-BigData &&
                git fetch --all &&
                git switch Front &&
                git reset --hard origin/Front &&
                git pull origin Front &&
                cd /home/***/Parcial1-BigData/Front/user-registration &&
                npm install &&
                npm run build &&
                sudo apt update &&
                sudo apt install -y apache2 &&
                sudo rm -rf /var/www/html/* &&
                sudo chown -R www-data:www-data /var/www/html/ &&
                sudo chmod -R 755 /var/www/html/ &&
                sudo cp -r /home/***/Parcial1-BigData/Front/user-registration/build/* /var/www/html/ &&
                sudo systemctl restart apache2
            '

